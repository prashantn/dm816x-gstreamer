/*
 * Copyright (C) $year Texas Instruments Incorporated - http://www.ti.com/
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation version 2.1 of the License.
 *
 * This program is distributed #as is# WITHOUT ANY WARRANTY of any kind,
 * whether express or implied; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 */

/* Load the Codec Engine 'Operating System Abstraction Layer' */
var osalGlobal = xdc.useModule('ti.sdo.ce.osal.Global');

var AACDEC    = xdc.useModule('ti.sdo.codecs.aachedec.ce.AACHEDEC')
var H264DEC   = xdc.useModule('ti.sdo.codecs.h264dec.ce.H264DEC');
var MPEG4DEC  = xdc.useModule('ti.sdo.codecs.mpeg4dec.ce.MPEG4DEC');
var MPEG2DEC  = xdc.useModule('ti.sdo.codecs.mpeg2dec.ce.MPEG2DEC');
var JPEGDEC   = xdc.useModule('ti.sdo.codecs.jpegdec.ce.JPEGDEC');
var JPEGENC   = xdc.useModule('ti.sdo.codecs.jpegenc.ce.JPEGENC');
var C6ACCEL   = xdc.useModule('ti.c6accel.ce.C6ACCEL');
var H264ENC   = xdc.useModule('ti.sdo.codecs.h264enc.ce.H264ENC');
var MPEG4ENC  = xdc.useModule('ti.sdo.codecs.mpeg4enc.ce.MPEG4ENC');

var os = xdc.useModule('ti.sdo.ce.osal.linux.Settings');
osalGlobal.os = os;

/* Configure CE to use it's DSP Link Linux version */
var ipc = xdc.useModule('ti.sdo.ce.ipc.Settings');
ipc.commType = ipc.COMM_DSPLINK;

/*
*  ======== Engine Configuration ========
 */
var Engine = xdc.useModule('ti.sdo.ce.Engine');

var demoEngine = Engine.create("codecServer", [
	{name: "aachedec", mod:AACDEC, local:false},
	{name: "h264dec", mod:H264DEC, local:false},
	{name: "mpeg4dec", mod:MPEG4DEC, local:false},
	{name: "mpeg2dec", mod:MPEG2DEC, local:false},
	{name: "jpegdec", mod:JPEGDEC, local:false},
	{name: "jpegenc", mod:JPEGENC, local:false},
	{name: "c6accel", mod:C6ACCEL, local:false},
	{name: "h264enc", mod:H264ENC, local:false},
	{name: "mpeg4enc", mod:MPEG4ENC, local:false},
]);

/* Remote server image */
var combopath = "" + java.lang.System.getenv("CODEC_SERVER");
if (combopath != "" && combopath != "null") {
	demoEngine.server = java.lang.System.getenv("CODEC_SERVER");
}
else {
	demoEngine.server = "./cs.x64P";
}

var dsplinkDspLinkCfg = xdc.useModule('ti.sdo.ce.ipc.dsplink.DspLinkCfg');

/* ======== Server memory map (DSPLINK) configuration ========
 * This table must match exactly the addresses and sizes of segments in the 
 * Server BIOS configuration (.tcf) script. There is exactly one "main", one 
 * "link", and one "reset" segment type, and zero or more of "other" types.
 */

/* use the default memory map config for this server */
demoEngine.armDspLinkConfig = dsplinkDspLinkCfg.DEFAULT_ARMDSPLINKCONFIG[Program.cpu.deviceName];
demoEngine.armDspLinkConfig.memTable["DDR2"].addr = 0xC3C00000;
demoEngine.armDspLinkConfig.memTable["DDR2"].size = 0x00300000;
demoEngine.armDspLinkConfig.memTable["DDRALGHEAP"].addr = 0xC3200000;
demoEngine.armDspLinkConfig.memTable["DDRALGHEAP"].size = 0x00A00000;
demoEngine.armDspLinkConfig.memTable["DSPLINKMEM"].addr = 0xC3F01000;
demoEngine.armDspLinkConfig.memTable["DSPLINKMEM"].size = 0x000FF000;
demoEngine.armDspLinkConfig.memTable["RESETCTRL"].addr = 0xC3F00000;
demoEngine.armDspLinkConfig.memTable["RESETCTRL"].size = 0x00000080;

/* Load support for the DMAI module */
var DMAI = xdc.loadPackage('ti.sdo.dmai');


